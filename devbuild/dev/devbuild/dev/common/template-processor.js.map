{"version":3,"sources":["common/template-processor.js"],"names":[],"mappings":"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","file":"common/template-processor.js","sourceRoot":"/source/","sourcesContent":["import {inject} from 'aurelia-dependency-injection';\r\nimport {Util} from '../common/util';\r\nimport {TemplatingEngine} from 'aurelia-templating';\r\n@inject(TemplatingEngine, Util)\r\nexport class TemplateProcessor {\r\n\r\n  constructor(context, templateEngine) {\r\n    this.context = context;\r\n    this.templatingEngine = templateEngine;\r\n    this.util = new Util();\r\n  }\r\n\r\n  initTemplate() {\r\n    let proxy = this;\r\n    ej.template.render = function(self, selector, data, index) {\r\n      return proxy.renderStringTemplate(self, selector, data, index);\r\n    };\r\n  }\r\n\r\n  initWidgetDependancies() {\r\n    if ( this.context.widget.aureliaTemplate) {\r\n      this.compileTemplate(this.context.widget.element);\r\n    }\r\n    let proxy =  this.context;\r\n    let element =  this.context.widget.element;\r\n    element.on( this.context.widget.pluginName + 'refresh', function() {\r\n      if (proxy.widget.aureliaTemplate) {\r\n        proxy.templateProcessor.compileTemplate(element);\r\n      }\r\n    });\r\n  }\r\n\r\n  renderStringTemplate(self, selector, data, index) {\r\n    let templateObject = self.aureliaTemplate;\r\n    if (!templateObject || !templateObject[selector]) {\r\n      templateObject = templateObject || {};\r\n      templateObject[selector] = { key: ej.getGuid('aurtmpl'), itemData: [], views: [] };\r\n      self.aureliaTemplate = templateObject;\r\n    }\r\n    let scope = templateObject[selector];\r\n    if (this.util.hasValue(index)) {\r\n      scope.itemData[index] = data;\r\n    } else {\r\n      scope.itemData = [data];\r\n    }\r\n    let actElement = $(selector).html();\r\n    let tempElement = \"<div class='\" + templateObject[selector].key + \" ej-aurelia-template'>\" + actElement + '</div>';\r\n    return tempElement;\r\n  }\r\n\r\n  compileTemplate(element) {\r\n    let templates = $(element).find('.ej-aurelia-template');\r\n    let templateObject =  this.context.widget.aureliaTemplate;\r\n    for (let template in templateObject) {\r\n      let tmplElement = templates.filter('.' + templateObject[template].key);\r\n      if (tmplElement.length) {\r\n        for (let i = 0; i < tmplElement.length; i++) {\r\n          let view = this.templatingEngine.enhance(tmplElement[i]);\r\n          view.bind(templateObject[template].itemData[i]);\r\n          templateObject[template].views[i] = view;\r\n        }\r\n      } else {\r\n        this.unbindViews(templateObject[template]);\r\n        delete templateObject[template];\r\n      }\r\n    }\r\n  }\r\n\r\n  clearTempalte() {\r\n    let templateObject =  this.context.widget.aureliaTemplate;\r\n    if (templateObject && Object.keys(templateObject).length) {\r\n      for (let t in templateObject) {\r\n        this.unbindViews(templateObject[t]);\r\n        delete templateObject[t];\r\n      }\r\n    }\r\n  }\r\n\r\n  unbindViews(obj) {\r\n    for (let i = 0; i < obj.views.length; i++) {\r\n      let view = obj.views[i];\r\n      view.unbind();\r\n    }\r\n  }\r\n\r\n}\r\n"]}